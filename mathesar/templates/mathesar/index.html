{% extends 'mathesar/base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block styles %}
  {% if not development_mode %} 
    {% for css_file in manifest_data.module_css %}
      <link rel="stylesheet" href="{% static css_file %}" />
    {% endfor %} 
  {% endif %}
{% endblock %}

{% block scripts %}
  {{ common_data|json_script:"common-data" }}
  {% if route_specific_data %}
    {% for key, value in route_specific_data.items %}
        {{ value|json_script:key }}
    {% endfor %}
  {% endif %}

  {% comment %} Making it async to start the execution as soon as its downloaded without making it wait for the HTML to be parsed {% endcomment %}
  <script type="module"  async>
  var isDevelopmentMode = {{ development_mode|yesno:"true,false" }}
    var src = isDevelopmentMode ? "{{ client_dev_url }}/src/i18n/{{ display_language }}/index.ts" : "{% static manifest_data.module_translations_file %}"
    import(src).then(translations => {
      window.translations = {
        lang: "{{ display_language }}",
        translationStrings: JSON.stringify(translations.default)
      }
    })
  </script>

  {% if development_mode %}
    <script type="module" src="{{ client_dev_url }}/@vite/client"></script>
    <script type="module" src="{{ client_dev_url }}/src/main.ts"></script>
  {% else %}
    <!-- For legacy browsers that do not support modules -->
    <script nomodule>
      !(function () {
        var e = document,
          t = e.createElement("script");
        if (!("noModule" in t) && "onbeforeload" in t) {
          var n = !1;
          e.addEventListener(
            "beforeload",
            function (e) {
              if (e.target === t) n = !0;
              else if (!e.target.hasAttribute("nomodule") || !n) return;
              e.preventDefault();
            },
            !0
          ),
            (t.type = "module"),
            (t.src = "."),
            e.head.appendChild(t),
            t.remove();
        }
      })();
    </script>

    <script type="module" src="{% static manifest_data.module_js %}"></script>
    <script
      nomodule
      src="{% static manifest_data.legacy_polyfill_js %}"
    ></script>
    <script
      nomodule
      async
      id="vite-legacy-translations-slot"
      data-src="{% static manifest_data.legacy_translations_file %}"
    >
      System.import(
        document.getElementById("vite-legacy-translations-slot").getAttribute("data-src")
      );
    </script>
    <script
      nomodule
      id="vite-legacy-js-slot"
      data-src="{% static manifest_data.legacy_js %}"
    >
      System.import(
        document.getElementById("vite-legacy-js-slot").getAttribute("data-src")
      );
    </script>
    
  {% endif %}
{% endblock %}
